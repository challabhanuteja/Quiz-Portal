{% extends 'base.html' %}
{% block title %}
Atlas Quiz
{% endblock title %}
{% block body %}
<link href='https://api.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.css' rel='stylesheet' />
<style>
    .row {
        display: flex;
    }

    .column {
        flex: 50%;
        padding: 5px;
    }
</style>
<div class="container-fluid">
    <h3>Let's find out how many country names you know!</h3>
    <label for="input_place">Enter country name</label>
    <input type="text" name="input_place" id="input_place">
    <a href="#" onclick="checkPlace()" class="btn btn-primary" id="next_button">Next</a>
    <a href="#" onclick="seeUnknownCountries()" class="btn btn-primary" id="see_unknow_countries_button">See Unknown Countries</a>

    <div id='map' style='width: 95vw; height: 70vh;' class="my-3"></div>

    <h3 id="known_countries">Known Countries : 0</h3>
    <div class="table-responsive">
        <table class="table" oncopy="return false" oncut="return false" onpaste="return false">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Country</th>
                </tr>
            </thead>
            <tbody id="countries">

            </tbody>
        </table>
    </div>
</div>
<script src='https://api.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.js'></script>
<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiY2hhbGxhYmhhbnV0ZWphIiwiYSI6ImNranRyb3F0bjQxZGYzMHFvdGl3YW5sdXYifQ.Z8Pn57WQy2ohKorOin7uvA';
    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/challabhanuteja/ckjtsazx208kz19qnjvutw6ia',
        zoom: 1,
        renderWorldCopies: false,
    });
    var countries_inputted = [
        "in",
        "iso_3166_1_alpha_3",
    ]
    map.on('load', function () {
        map.addLayer(
            {
                id: 'country-boundaries',
                source: {
                    type: 'vector',
                    url: 'mapbox://mapbox.country-boundaries-v1',
                },
                'source-layer': 'country_boundaries',
                type: 'fill',
                paint: {
                    'fill-color': 'green',
                    'fill-opacity': 0.4,
                },
            },
            'country-label'
        );
        map.addLayer(
            {
                id: 'unknown_countries',
                source: {
                    type: 'vector',
                    url: 'mapbox://mapbox.country-boundaries-v1',
                },
                'source-layer': 'country_boundaries',
                type: 'fill',
                paint: {
                    'fill-color': 'red',
                    'fill-opacity': 0.4,
                },
            },
            'country-label'
        );
        map.setFilter('country-boundaries', countries_inputted);
        map.setFilter('unknown_countries', countries_inputted);

    });
    var countries_and_codes = { "afghanistan": "AFG", "albania": "ALB", "algeria": "DZA", "american samoa": "ASM", "andorra": "AND", "angola": "AGO", "anguilla": "AIA", "antarctica": "ATA", "antigua and barbuda": "ATG", "argentina": "ARG", "armenia": "ARM", "aruba": "ABW", "australia": "AUS", "austria": "AUT", "azerbaijan": "AZE", "bahamas": "BHS", "bahrain": "BHR", "bangladesh": "BGD", "barbados": "BRB", "belarus": "BLR", "belgium": "BEL", "belize": "BLZ", "benin": "BEN", "bermuda": "BMU", "bhutan": "BTN", "bolivia, plurinational state of": "BOL", "bolivia": "BOL", "bosnia and herzegovina": "BIH", "botswana": "BWA", "bouvet island": "BVT", "brazil": "BRA", "british indian ocean territory": "IOT", "brunei darussalam": "BRN", "brunei": "BRN", "bulgaria": "BGR", "burkina faso": "BFA", "burundi": "BDI", "cambodia": "KHM", "cameroon": "CMR", "canada": "CAN", "cape verde": "CPV", "cayman islands": "CYM", "central african republic": "CAF", "chad": "TCD", "chile": "CHL", "china": "CHN", "christmas island": "CXR", "cocos (keeling) islands": "CCK", "colombia": "COL", "comoros": "COM", "congo": "COG", "congo, the democratic republic of the": "COD", "cook islands": "COK", "costa rica": "CRI", "c�te d'ivoire": "CIV", "ivory coast": "CIV", "croatia": "HRV", "cuba": "CUB", "cyprus": "CYP", "czech republic": "CZE", "denmark": "DNK", "djibouti": "DJI", "dominica": "DMA", "dominican republic": "DOM", "ecuador": "ECU", "egypt": "EGY", "el salvador": "SLV", "equatorial guinea": "GNQ", "eritrea": "ERI", "estonia": "EST", "ethiopia": "ETH", "falkland islands (malvinas)": "FLK", "faroe islands": "FRO", "fiji": "FJI", "finland": "FIN", "france": "FRA", "french guiana": "GUF", "french polynesia": "PYF", "french southern territories": "ATF", "gabon": "GAB", "gambia": "GMB", "georgia": "GEO", "germany": "DEU", "ghana": "GHA", "gibraltar": "GIB", "greece": "GRC", "greenland": "GRL", "grenada": "GRD", "guadeloupe": "GLP", "guam": "GUM", "guatemala": "GTM", "guernsey": "GGY", "guinea": "GIN", "guinea-bissau": "GNB", "guyana": "GUY", "haiti": "HTI", "heard island and mcdonald islands": "HMD", "holy see (vatican city state)": "VAT", "honduras": "HND", "hong kong": "HKG", "hungary": "HUN", "iceland": "ISL", "india": "IND", "indonesia": "IDN", "iran, islamic republic of": "IRN", "iraq": "IRQ", "ireland": "IRL", "isle of man": "IMN", "israel": "ISR", "italy": "ITA", "jamaica": "JAM", "japan": "JPN", "jersey": "JEY", "jordan": "JOR", "kazakhstan": "KAZ", "kenya": "KEN", "kiribati": "KIR", "korea, democratic people's republic of": "PRK", "korea, republic of": "KOR", "south korea": "KOR", "kuwait": "KWT", "kyrgyzstan": "KGZ", "lao people's democratic republic": "LAO", "latvia": "LVA", "lebanon": "LBN", "lesotho": "LSO", "liberia": "LBR", "libyan arab jamahiriya": "LBY", "libya": "LBY", "liechtenstein": "LIE", "lithuania": "LTU", "luxembourg": "LUX", "macao": "MAC", "macedonia, the former yugoslav republic of": "MKD", "madagascar": "MDG", "malawi": "MWI", "malaysia": "MYS", "maldives": "MDV", "mali": "MLI", "malta": "MLT", "marshall islands": "MHL", "martinique": "MTQ", "mauritania": "MRT", "mauritius": "MUS", "mayotte": "MYT", "mexico": "MEX", "micronesia, federated states of": "FSM", "moldova, republic of": "MDA", "monaco": "MCO", "mongolia": "MNG", "montenegro": "MNE", "montserrat": "MSR", "morocco": "MAR", "mozambique": "MOZ", "myanmar": "MMR", "burma": "MMR", "namibia": "NAM", "nauru": "NRU", "nepal": "NPL", "netherlands": "NLD", "netherlands antilles": "ANT", "new caledonia": "NCL", "new zealand": "NZL", "nicaragua": "NIC", "niger": "NER", "nigeria": "NGA", "niue": "NIU", "norfolk island": "NFK", "northern mariana islands": "MNP", "norway": "NOR", "oman": "OMN", "pakistan": "PAK", "palau": "PLW", "palestinian territory, occupied": "PSE", "panama": "PAN", "papua new guinea": "PNG", "paraguay": "PRY", "peru": "PER", "philippines": "PHL", "pitcairn": "PCN", "poland": "POL", "portugal": "PRT", "puerto rico": "PRI", "qatar": "QAT", "r�union": "REU", "romania": "ROU", "russian federation": "RUS", "russia": "RUS", "rwanda": "RWA", "saint helena, ascension and tristan da cunha": "SHN", "saint kitts and nevis": "KNA", "saint lucia": "LCA", "saint pierre and miquelon": "SPM", "saint vincent and the grenadines": "VCT", "saint vincent & the grenadines": "VCT", "st. vincent and the grenadines": "VCT", "samoa": "WSM", "san marino": "SMR", "sao tome and principe": "STP", "saudi arabia": "SAU", "senegal": "SEN", "serbia": "SRB", "seychelles": "SYC", "sierra leone": "SLE", "singapore": "SGP", "slovakia": "SVK", "slovenia": "SVN", "solomon islands": "SLB", "somalia": "SOM", "south africa": "ZAF", "south georgia and the south sandwich islands": "SGS", "south sudan": "SSD", "spain": "ESP", "sri lanka": "LKA", "sudan": "SDN", "suriname": "SUR", "svalbard and jan mayen": "SJM", "swaziland": "SWZ", "sweden": "SWE", "switzerland": "CHE", "syrian arab republic": "SYR", "taiwan, province of china": "TWN", "taiwan": "TWN", "tajikistan": "TJK", "tanzania, united republic of": "TZA", "thailand": "THA", "timor-leste": "TLS", "togo": "TGO", "tokelau": "TKL", "tonga": "TON", "trinidad and tobago": "TTO", "tunisia": "TUN", "turkey": "TUR", "turkmenistan": "TKM", "turks and caicos islands": "TCA", "tuvalu": "TUV", "uganda": "UGA", "ukraine": "UKR", "united arab emirates": "ARE", "united kingdom": "GBR", "united states": "USA", "united states minor outlying islands": "UMI", "uruguay": "URY", "uzbekistan": "UZB", "vanuatu": "VUT", "venezuela, bolivarian republic of": "VEN", "venezuela": "VEN", "viet nam": "VNM", "vietnam": "VNM", "virgin islands, british": "VGB", "virgin islands, u.s.": "VIR", "wallis and futuna": "WLF", "western sahara": "ESH", "yemen": "YEM", "zambia": "ZMB", "zimbabwe": "ZWE" };
    var countries_table = ``;
    var country_no = 1;
    let all_country_codes =[
        "in",
        "iso_3166_1_alpha_3",
    ];
    let all_countries = [];
    for (var country in countries_and_codes) {
        let x = countries_and_codes[country];
        country = country.replace(/\w\S*/g, function (txt) { return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase(); });
        countries_table += `
            <tr>
                <th scope="row">${country_no}</th>
                <td  id = "${x}" style="background-color : #212529; display:inline;">${country}</td>
            </tr>
        `;
        all_country_codes.push(countries_and_codes[country.toLowerCase()]);
        all_countries.push(country);
        country_no++;
    }
    document.getElementById("countries").innerHTML = countries_table;
    function checkPlace() {
        let place = document.getElementById("input_place").value;
        place = place.toLowerCase();
        if (countries_and_codes[place] != undefined) {
            countries_inputted.push(countries_and_codes[place])
            all_country_codes = all_country_codes.filter(val => val !==countries_and_codes[place]);
            all_countries = all_countries.filter(val => val !== place);
            map.setFilter('country-boundaries', countries_inputted);
            let kc = "Known Countries : " + (countries_inputted.length - 2).toString()
            document.getElementById("known_countries").innerHTML = kc;
            document.getElementById(countries_and_codes[place]).style = "background-color : green; color: white;"
        }

        document.getElementById("input_place").value = "";
    }
    var input = document.getElementById("input_place");

    input.addEventListener("keyup", function (event) {
        if (event.keyCode === 13) {
            // Cancel the default action, if needed
            event.preventDefault();
            // Trigger the button element with a click
            document.getElementById("next_button").click();
        }
    });
    function seeUnknownCountries()
    {
        console.log(all_country_codes);
        map.setFilter('unknown_countries', all_country_codes);
        let j = 0;
        for(let i in all_country_codes)
        {
            if(i>=2)
            {
                console.log(all_country_codes[i]);   
                document.getElementById(all_country_codes[i]).style = "background-color : red; color: white;";
            }
        }
    }
</script>
{% endblock body %}